import{IS_HIDPI}from"./constants.js";import{spriteDefinitionByType}from"./offline-sprite-definitions.js";import{getRandomNum}from"./utils.js";class NightMode{constructor(canvas,spritePos,containerWidth){this.spritePos=spritePos,this.canvas=canvas,this.canvasCtx=canvas.getContext("2d"),this.xPos=containerWidth-50,this.yPos=30,this.currentPhase=0,this.opacity=0,this.containerWidth=containerWidth,this.stars=[],this.drawStars=!1,this.placeStars()}update(activated){if(activated&&0===this.opacity&&(this.currentPhase++,this.currentPhase>=NightMode.phases.length)&&(this.currentPhase=0),activated&&(this.opacity<1||0===this.opacity)?this.opacity+=NightMode.config.FADE_SPEED:0<this.opacity&&(this.opacity-=NightMode.config.FADE_SPEED),0<this.opacity){if(this.xPos=this.updateXPos(this.xPos,NightMode.config.MOON_SPEED),this.drawStars)for(let i=0;i<NightMode.config.NUM_STARS;i++)this.stars[i].x=this.updateXPos(this.stars[i].x,NightMode.config.STAR_SPEED);this.draw()}else this.opacity=0,this.placeStars();this.drawStars=!0}updateXPos(currentPos,speed){return currentPos<-NightMode.config.WIDTH?currentPos=this.containerWidth:currentPos-=speed,currentPos}draw(){this.currentPhase,NightMode.config.WIDTH,NightMode.config.HEIGHT,this.spritePos.x,NightMode.phases[this.currentPhase];let starSize=NightMode.config.STAR_SIZE,starSourceX=spriteDefinitionByType.original.LDPI.STAR.x;if(IS_HIDPI&&(this.spritePos.x,NightMode.phases[this.currentPhase],starSize*=2,starSourceX=spriteDefinitionByType.original.HDPI.STAR.x),this.canvasCtx.save(),this.canvasCtx.globalAlpha=this.opacity,this.drawStars)for(let i=0;i<NightMode.config.NUM_STARS;i++)this.canvasCtx.drawImage(window.Runner.origImageSprite,starSourceX,this.stars[i].sourceY,starSize,starSize,Math.round(this.stars[i].x),this.stars[i].y,NightMode.config.STAR_SIZE,NightMode.config.STAR_SIZE);this.canvasCtx.globalAlpha=1,this.canvasCtx.restore()}placeStars(){var segmentSize=Math.round(this.containerWidth/NightMode.config.NUM_STARS);for(let i=0;i<NightMode.config.NUM_STARS;i++)this.stars[i]={},this.stars[i].x=getRandomNum(segmentSize*i,segmentSize*(i+1)),this.stars[i].y=getRandomNum(0,NightMode.config.STAR_MAX_Y),this.stars[i].sourceY=IS_HIDPI?spriteDefinitionByType.original.HDPI.STAR.y+2*NightMode.config.STAR_SIZE*i:spriteDefinitionByType.original.LDPI.STAR.y+NightMode.config.STAR_SIZE*i}reset(){this.currentPhase=0,this.opacity=0,this.update(!1)}}NightMode.config={FADE_SPEED:.035,HEIGHT:40,MOON_SPEED:.25,NUM_STARS:6,STAR_SIZE:9,STAR_SPEED:.3,STAR_MAX_Y:70,WIDTH:20},NightMode.phases=[140,120,100,60,40,20,0];export{NightMode};