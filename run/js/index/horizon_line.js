import{FPS,IS_HIDPI}from"./constants.js";class HorizonLine{constructor(canvas,lineConfig){let sourceX=lineConfig.SOURCE_X,sourceY=lineConfig.SOURCE_Y;IS_HIDPI&&(sourceX*=2,sourceY*=2),this.spritePos={x:sourceX,y:sourceY},this.canvas=canvas,this.canvasCtx=canvas.getContext("2d"),this.sourceDimensions={},this.dimensions=lineConfig,this.sourceXPos=[this.spritePos.x,this.spritePos.x+this.dimensions.WIDTH],this.xPos=[],this.yPos=0,this.bumpThreshold=.5,this.setSourceDimensions(lineConfig),this.draw()}setSourceDimensions(newDimensions){for(var dimension in newDimensions)"SOURCE_X"!==dimension&&"SOURCE_Y"!==dimension&&(IS_HIDPI?"YPOS"!==dimension&&(this.sourceDimensions[dimension]=2*newDimensions[dimension]):this.sourceDimensions[dimension]=newDimensions[dimension],this.dimensions[dimension]=newDimensions[dimension]);this.xPos=[0,newDimensions.WIDTH],this.yPos=newDimensions.YPOS}getRandomType(){return Math.random()>this.bumpThreshold?this.dimensions.WIDTH:0}draw(){this.canvasCtx.drawImage(window.Runner.imageSprite,this.sourceXPos[0],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[0],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT),this.canvasCtx.drawImage(window.Runner.imageSprite,this.sourceXPos[1],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[1],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT)}updateXPos(pos,increment){var line1=pos,pos=0===pos?1:0;this.xPos[line1]-=increment,this.xPos[pos]=this.xPos[line1]+this.dimensions.WIDTH,this.xPos[line1]<=-this.dimensions.WIDTH&&(this.xPos[line1]+=2*this.dimensions.WIDTH,this.xPos[pos]=this.xPos[line1]-this.dimensions.WIDTH,this.sourceXPos[line1]=this.getRandomType()+this.spritePos.x)}update(deltaTime,speed){speed=Math.floor(speed*(FPS/1e3)*deltaTime);this.xPos[0]<=0?this.updateXPos(0,speed):this.updateXPos(1,speed),this.draw()}reset(){this.xPos[0]=0,this.xPos[1]=this.dimensions.WIDTH}}export{HorizonLine};