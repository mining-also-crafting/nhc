import{FPS,IS_HIDPI,IS_MOBILE}from"./constants.js";import{CollisionBox}from"./offline-sprite-definitions.js";import{getRandomNum}from"./utils.js";class Obstacle{constructor(canvasCtx,type,spriteImgPos,dimensions,gapCoefficient,speed,opt_xOffset,opt_isAltGameMode){this.canvasCtx=canvasCtx,this.spritePos=spriteImgPos,this.typeConfig=type,this.gapCoefficient=window.Runner.slowDown?2*gapCoefficient:gapCoefficient,this.size=getRandomNum(1,Obstacle.MAX_OBSTACLE_LENGTH),this.dimensions=dimensions,this.remove=!1,this.xPos=dimensions.WIDTH+(opt_xOffset||0),this.yPos=0,this.width=0,this.collisionBoxes=[],this.gap=0,this.speedOffset=0,this.altGameModeActive=opt_isAltGameMode,this.imageSprite="COLLECTABLE"===this.typeConfig.type?window.Runner.altCommonImageSprite:this.altGameModeActive?window.Runner.altGameImageSprite:window.Runner.imageSprite,this.currentFrame=0,this.timer=0,this.init(speed)}init(speed){var yPosConfig;this.cloneCollisionBoxes(),1<this.size&&this.typeConfig.multipleSpeed>speed&&(this.size=1),this.width=this.typeConfig.width*this.size,Array.isArray(this.typeConfig.yPos)?(yPosConfig=IS_MOBILE?this.typeConfig.yPosMobile:this.typeConfig.yPos,this.yPos=yPosConfig[getRandomNum(0,yPosConfig.length-1)]):this.yPos=this.typeConfig.yPos,this.draw(),1<this.size&&(this.collisionBoxes[1].width=this.width-this.collisionBoxes[0].width-this.collisionBoxes[2].width,this.collisionBoxes[2].x=this.width-this.collisionBoxes[2].width),this.typeConfig.speedOffset&&(this.speedOffset=.5<Math.random()?this.typeConfig.speedOffset:-this.typeConfig.speedOffset),this.gap=this.getGap(this.gapCoefficient,speed),window.Runner.audioCues&&(this.gap*=2)}draw(){let sourceWidth=this.typeConfig.width,sourceHeight=this.typeConfig.height,sourceX=(IS_HIDPI&&(sourceWidth*=2,sourceHeight*=2),sourceWidth*this.size*(.5*(this.size-1))+this.spritePos.x);0<this.currentFrame&&(sourceX+=sourceWidth*this.currentFrame),this.canvasCtx.drawImage(this.imageSprite,sourceX,this.spritePos.y,sourceWidth*this.size,sourceHeight,this.xPos,this.yPos,this.typeConfig.width*this.size,this.typeConfig.height)}update(deltaTime,speed){this.remove||(this.typeConfig.speedOffset&&(speed+=this.speedOffset),this.xPos-=Math.floor(speed*FPS/1e3*deltaTime),this.typeConfig.numFrames&&(this.timer+=deltaTime,this.timer>=this.typeConfig.frameRate)&&(this.currentFrame=this.currentFrame===this.typeConfig.numFrames-1?0:this.currentFrame+1,this.timer=0),this.draw(),this.isVisible())||(this.remove=!0)}getGap(gapCoefficient,speed){speed=Math.round(this.width*speed+this.typeConfig.minGap*gapCoefficient),gapCoefficient=Math.round(speed*Obstacle.MAX_GAP_COEFFICIENT);return getRandomNum(speed,gapCoefficient)}isVisible(){return 0<this.xPos+this.width}cloneCollisionBoxes(){var collisionBoxes=this.typeConfig.collisionBoxes;for(let i=collisionBoxes.length-1;0<=i;i--)this.collisionBoxes[i]=new CollisionBox(collisionBoxes[i].x,collisionBoxes[i].y,collisionBoxes[i].width,collisionBoxes[i].height)}}Obstacle.MAX_GAP_COEFFICIENT=1.5,Obstacle.MAX_OBSTACLE_LENGTH=3;export{Obstacle};